# 部分有用的开发指南
## 开发插件
1. 需要放在 `src/Modules/Plugins` 下
   1. 因为目前插件加载路径写死在这里了
2. 需要继承于 `OnMessagePlugin`
   1. 这样插件就会自动实现注册相关的接口
3. 声明成员 `listen` 作用范围
   1. 目前支持 `*`, `private`, `group`
4. 声明成员 `commands(k, v)` 用来声明监听的指令，`k` 为正则，`v` 为当前类中实现处理逻辑的成员函数
   1. 支持正则，默认情况下会在声明的正则前添加 `^` 和 `PREFIX`
   2. 如果声明的正则以 `^` 开头，则原样进行匹配
   3. 正则内支持捕获，捕获的参数会按顺序传入处理逻辑的函数
   4. 处理逻辑内支持依赖注入（在开头，且声明了参数类型的会被注入，`CQEvent` 就是注入进来的）

### 关于参数中的 CQEvent:
CQEvent 是通过依赖注入进来的事件参数，插件获取参数、操作返回值都是通过这个对象来进行的。  
因为继承关系是 `CQMessageEvent -> CQEvent`，且 `CQPrivateMessageEvent` 和 `CQGroupMessageEvent` 又是从 `CQMessageEvent` 派生的，因此如果确定某个函数只会处理群聊消息，可以用更详细的类来注入（方便代码提示）；否则可以使用 `CQMessageEvent` 来同时处理单聊和群聊消息。  

### 关于事件处理函数的返回值
目前不少函数都把事件对象返回了，实际上并不需要返回（因为目前返回值实际上是被忽略的），只需要调用 `$e->reply('blabla');` 就已经将这个内容保存到待返回的缓冲区了。

### 关于插件内调用数据库
目前暂时还没有做环境隔离，耦合了 Model，所以相当于插件直接操作 Model （直接操作表格）了，这个之后估计会引入一个 `Context` 类来解决上下文以及数据库访问的问题